<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3 Wallet and Transactions</title>
</head>
<body>
    <h1>Web3 Wallet Interaction</h1>
    <button id="connectButton">Connect Wallet</button>
    <p>Your Address: <span id="userAddress">Not Connected</span></p>
    <p>Your Balance: <span id="userBalance">0</span> ETH</p>
    <div>
        <h2>Send ETH</h2>
        <label for="toAddress">Recipient Address:</label>
        <input type="text" id="toAddress" placeholder="Recipient address">
        <label for="amount">Amount (ETH):</label>
        <input type="text" id="amount" placeholder="Amount in ETH">
        <button id="sendButton">Send ETH</button>
    </div>
    <div>
        <h2>Store Transaction</h2>
        <label for="transactionData">Transaction Data:</label>
        <input type="text" id="transactionData" placeholder="Enter details">
        <button id="storeTransactionButton">Store Transaction</button>
    </div>
    <h2>Stored Transactions</h2>
    <ul id="transactionList"></ul>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.3/dist/web3.min.js"></script>
    <script>
        let web3;
        let userAddress;

        // Connect to Metamask
        const connectWallet = async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: "eth_requestAccounts" });
                    const accounts = await web3.eth.getAccounts();
                    userAddress = accounts[0];
                    document.getElementById("userAddress").innerText = userAddress;
                    loadBalance();
                } catch (err) {
                    console.log("Error connecting to wallet", err);
                }
            } else {
                alert("Please install MetaMask!");
            }
        };

        // Load balance
        const loadBalance = async () => {
            if (web3) {
                const balanceWei = await web3.eth.getBalance(userAddress);
                const balance = web3.utils.fromWei(balanceWei, 'ether');
                document.getElementById("userBalance").innerText = balance;
            }
        };

        // Send ETH
        const sendEth = async () => {
            const toAddress = document.getElementById("toAddress").value;
            const amount = document.getElementById("amount").value;

            if (web3 && toAddress && amount) {
                const amountWei = web3.utils.toWei(amount, 'ether');
                try {
                    await web3.eth.sendTransaction({
                        from: userAddress,
                        to: toAddress,
                        value: amountWei
                    });
                    alert("Transaction Sent!");
                    loadBalance(); // Reload balance after sending funds
                } catch (err) {
                    console.log("Transaction failed", err);
                }
            } else {
                alert("Please fill all fields!");
            }
        };

        // Store Transaction Data (Fake Smart Contract interaction)
        const storeTransaction = async () => {
            const transactionData = document.getElementById("transactionData").value;
            if (transactionData) {
                // Store transaction data in the front end (simulate storing on-chain)
                const transactionItem = document.createElement('li');
                transactionItem.innerText = `Transaction: ${transactionData}`;
                document.getElementById("transactionList").appendChild(transactionItem);
                alert("Transaction Data Stored!");
            } else {
                alert("Please enter transaction data!");
            }
        };

        // Event Listeners
        document.getElementById("connectButton").addEventListener("click", connectWallet);
        document.getElementById("sendButton").addEventListener("click", sendEth);
        document.getElementById("storeTransactionButton").addEventListener("click", storeTransaction);
    </script>
</body>
</html>
